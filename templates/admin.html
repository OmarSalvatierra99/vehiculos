{% extends "base.html" %}

{% block title %}Administracion Â· Inventario vehicular{% endblock %}

{% block content %}
<section class="page-header">
  <div>
    <h2>Panel administrativo</h2>
    <p>Inventario completo, estatus de unidades y reportes oficiales.</p>
  </div>
  <div class="date-chip">
    <span>Fecha de corte</span>
    <strong>{{ today }}</strong>
  </div>
</section>

<section class="stats-grid">
  <div class="stat-card">
    <span>Unidades registradas</span>
    <strong>{{ total_vehiculos }}</strong>
    <small>Placas activas</small>
  </div>
  <div class="stat-card">
    <span>Inventario total</span>
    <strong>{{ total_stock }}</strong>
    <small>Unidades institucionales</small>
  </div>
  <div class="stat-card">
    <span>Disponibles hoy</span>
    <strong>{{ total_disponible }}</strong>
    <small>Listas para asignacion</small>
  </div>
  <div class="stat-card">
    <span>Movimientos activos</span>
    <strong>{{ movimientos_en_uso }}</strong>
    <small>{{ movimientos_alerta }} alertas</small>
  </div>
</section>

<section class="grid">
  <div class="card">
    <h2>Unidades registradas</h2>
    <p class="subtitle">Relacion oficial de placas activas.</p>
    {% if vehiculos %}
    <div class="table table-3">
      <div class="table-row header">
        <span>Placa</span>
        <span>Modelo</span>
        <span>Marca</span>
      </div>
      {% for vehiculo in vehiculos %}
      <div class="table-row">
        <span class="mono">{{ vehiculo.placa }}</span>
        <span>{{ vehiculo.modelo }}</span>
        <span>{{ vehiculo.marca }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="empty">No hay placas registradas.</p>
    {% endif %}
  </div>
</section>

<section class="card">
  <div class="card-header">
    <div>
      <h2>Movimientos y reportes</h2>
      <p class="subtitle">Seguimiento de estatus y generacion de reportes.</p>
    </div>
    {% if rol == "monitor" %}
    <div class="actions-inline">
      <a class="btn ghost" href="{{ url_for('reporte_diario') }}">Reporte del dia</a>
    </div>
    {% endif %}
  </div>
  {% if movimientos %}
  <div class="table table-7">
    <div class="table-row header">
      <span>Folio</span>
      <span>Unidad</span>
      <span>Solicitante</span>
      <span>Solicitud</span>
      <span>Entrega</span>
      <span>Estatus</span>
      <span>{% if rol == "monitor" %}Validar{% else %}Reporte{% endif %}</span>
    </div>
    {% for mov in movimientos %}
    <div class="table-row">
      <span class="mono">{{ mov.data.folio }}</span>
      <span>[{{ mov.data.sigla }}] {{ mov.data.item_nombre }}</span>
      <span>{{ mov.data.usuario_nombre }}</span>
      <span>{{ mov.data.fecha_solicitud }}</span>
      <span>{{ mov.data.fecha_entrega or "Pendiente" }}</span>
      <span>
        {% if mov.data.devuelto %}
          Devuelto
        {% elif mov.alerta %}
          Alerta +7 dias
        {% elif mov.data.fecha_entrega %}
          En uso
        {% else %}
          Pendiente
        {% endif %}
      </span>
      <span class="actions-inline">
        {% if rol == "monitor" %}
          {% if mov.data.fecha_entrega %}
            <span class="badge success">Validado</span>
          {% else %}
            <form method="post" action="{{ url_for('movimientos_entregar', mov_id=mov.data.id) }}">
              <button class="btn ghost btn-small" type="submit">Validar</button>
            </form>
          {% endif %}
        {% else %}
          <a class="btn ghost" href="{{ url_for('reporte_movimiento', mov_id=mov.data.id) }}">Reporte</a>
        {% endif %}
      </span>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="empty">Sin movimientos registrados.</p>
  {% endif %}
</section>

<section class="grid">
  <div class="card">
    <h2>Personal responsable</h2>
    <p class="subtitle">Directorio de responsables de unidades.</p>
    {% if responsables %}
    <div class="pill-list">
      {% for responsable in responsables %}
      <span class="pill">{{ responsable.nombre }}</span>
      {% endfor %}
    </div>
    {% else %}
    <p class="empty">No hay responsables registrados.</p>
    {% endif %}
  </div>

  <div class="card">
    <h2>Auditores</h2>
    <p class="subtitle">Captura manual habilitada para solicitudes.</p>
    <p class="empty">No hay catalogo cargado.</p>
  </div>
</section>
{% endblock %}
