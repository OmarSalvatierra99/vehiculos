{% extends "base.html" %}

{% block title %}Gestor Â· Inventario vehicular{% endblock %}

{% block content %}
<section class="page-header">
  <div>
    <h2>Gestor de inventario</h2>
    <p>Administre vehiculos, stock y movimientos en un solo tablero.</p>
  </div>
</section>

<section class="grid">
  <div class="card">
    <div class="card-header">
      <h2>Alta de vehiculos</h2>
      <p class="subtitle">Registre unidades con su sigla oficial.</p>
    </div>
    <form method="post" action="{{ url_for('inventario_nuevo') }}" class="form-grid">
      {% if error %}
      <div class="alert full">{{ error }}</div>
      {% endif %}
      <label>
        Sigla
        <input type="text" name="sigla" required>
      </label>
      <input type="hidden" name="categoria" value="VEHICULO">
      <label class="full">
        Nombre del vehiculo
        <input type="text" name="nombre" required>
      </label>
      <label>
        No. de inventario
        <input type="text" name="no_inventario">
      </label>
      <label>
        Stock total
        <input type="number" name="stock_total" min="0" value="1" required>
      </label>
      <label class="full">
        Descripcion
        <textarea name="descripcion" rows="3"></textarea>
      </label>
      <div class="actions full">
        <button class="btn primary" type="submit">Registrar vehiculo</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Vehiculos vigentes</h2>
    <p class="subtitle">Control de unidades oficiales.</p>
    {% if items %}
    <div class="table table-4">
      <div class="table-row header">
        <span>Sigla</span>
        <span>Vehiculo</span>
        <span>Total</span>
        <span>Disponible</span>
      </div>
      {% for item in items %}
      <div class="table-row">
        <span class="mono">{{ item.sigla }}</span>
        <span>{{ item.nombre }}</span>
        <span>{{ item.stock_total }}</span>
        <span>{{ item.stock_disponible }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="empty">No hay vehiculos registrados.</p>
    {% endif %}
  </div>
</section>

<section class="card">
  <h2>Movimientos</h2>
  <p class="subtitle">Historial con control de entrega y devolucion.</p>
  <div class="table table-7">
    <div class="table-row header">
      <span>Folio</span>
      <span>Bien</span>
      <span>Solicitante</span>
      <span>Inventario</span>
      <span>Solicitud</span>
      <span>Entrega</span>
      <span>Acciones</span>
    </div>
    {% for mov in movimientos %}
    <div class="table-row">
      <span class="mono">{{ mov.data.folio }}</span>
      <span>[{{ mov.data.sigla }}] {{ mov.data.item_nombre }}</span>
      <span>{{ mov.data.usuario_nombre }}</span>
      <span>{{ mov.data.no_inventario or "-" }}</span>
      <span>{{ mov.data.fecha_solicitud }}</span>
      <span>{{ mov.data.fecha_entrega or "Pendiente" }}</span>
      <span class="actions-inline">
        {% if not mov.data.fecha_entrega %}
          <form method="post" action="{{ url_for('movimientos_entregar', mov_id=mov.data.id) }}">
            <button class="btn" type="submit">Entregar</button>
          </form>
        {% elif not mov.data.devuelto %}
          <form method="post" action="{{ url_for('movimientos_devolver', mov_id=mov.data.id) }}">
            <button class="btn ghost" type="submit">Devolver</button>
          </form>
        {% else %}
          <span class="badge success">Devuelto</span>
        {% endif %}
        {% if mov.alerta %}
          <span class="badge alert">Alerta +7 dias</span>
        {% endif %}
      </span>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
